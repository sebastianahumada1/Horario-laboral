<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta de Horarios</title>
    <!-- Versi√≥n: 20251218145142 -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .date-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-selector label {
            font-weight: 600;
            color: #555;
            font-size: 1.1em;
        }

        .date-selector input {
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .date-selector input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .analistas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
        }

        .analista-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .analista-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .analista-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .analista-item label {
            cursor: pointer;
            flex: 1;
            font-size: 0.95em;
            color: #333;
        }

        .btn-consultar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-consultar:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-consultar:active {
            transform: translateY(0);
        }

        .resultados {
            margin-top: 30px;
            display: none;
        }

        .resultados.show {
            display: block;
        }

        .resultado-item {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .resultado-item.trabaja {
            border-left-color: #28a745;
            background: #d4edda;
        }

        .resultado-item.no-trabaja {
            border-left-color: #dc3545;
            background: #f8d7da;
        }

        .resultado-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .resultado-nombre {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .resultado-estado {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .resultado-estado.trabaja {
            background: #28a745;
            color: white;
        }

        .resultado-estado.no-trabaja {
            background: #dc3545;
            color: white;
        }

        .resultado-detalles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detalle-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
        }

        .detalle-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
        }

        .detalle-valor {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.2em;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
        }

        .no-seleccion {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }

        .botones-seleccion {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
        }

        .btn-seleccionar,
        .btn-deseleccionar {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            min-height: 44px; /* Tama√±o m√≠nimo t√°ctil */
        }

        .btn-seleccionar {
            background: #667eea;
            color: white;
        }

        .btn-seleccionar:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }

        .btn-deseleccionar {
            background: #999;
            color: white;
        }

        .btn-deseleccionar:hover {
            background: #777;
            transform: translateY(-1px);
        }

        .btn-rotaciones {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s;
            min-height: 44px;
            background: #28a745;
            color: white;
        }

        .btn-rotaciones:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .rotaciones-container {
            margin-top: 30px;
            display: none;
        }

        .rotaciones-container.show {
            display: block;
        }

        .rotacion-item {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .rotacion-nombre {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }

        .rotacion-periodo {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .rotacion-horario {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .rotacion-fechas {
            color: #666;
            font-size: 0.95em;
        }

        /* Responsive Design - Tablets */
        @media (max-width: 968px) {
            .content {
                padding: 25px;
            }

            .header h1 {
                font-size: 2em;
            }

            .analistas-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .resultado-detalles {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* Responsive Design - M√≥viles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 1.6em;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.95em;
            }

            .content {
                padding: 20px 15px;
            }

            .section {
                margin-bottom: 25px;
            }

            .section-title {
                font-size: 1.2em;
                margin-bottom: 15px;
            }

            .date-selector {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }

            .date-selector label {
                font-size: 1em;
            }

            .date-selector input {
                width: 100%;
                min-width: unset;
                padding: 14px;
                font-size: 16px; /* Previene zoom en iOS */
            }

            .analistas-grid {
                grid-template-columns: 1fr;
                max-height: none;
                overflow-y: visible;
                gap: 10px;
                padding: 10px;
            }

            .analista-item {
                padding: 12px;
            }

            .analista-item label {
                font-size: 0.9em;
            }

            .btn-consultar {
                width: 100%;
                padding: 16px;
                font-size: 1em;
            }

            .resultado-item {
                padding: 15px;
                margin-bottom: 12px;
            }

            .resultado-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .resultado-nombre {
                font-size: 1.1em;
                width: 100%;
            }

            .resultado-estado {
                font-size: 0.85em;
                padding: 6px 12px;
                align-self: flex-start;
            }

            .resultado-detalles {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-top: 12px;
            }

            .detalle-item {
                padding: 10px;
            }

            .detalle-label {
                font-size: 0.8em;
            }

            .detalle-valor {
                font-size: 1em;
            }

            /* Botones de seleccionar todos */
            .botones-seleccion {
                flex-direction: column;
                justify-content: stretch;
            }

            .botones-seleccion button {
                width: 100%;
                padding: 12px;
                font-size: 0.95em;
            }

            .rotacion-item {
                padding: 15px;
            }

            .rotacion-nombre {
                font-size: 1.1em;
            }

            .rotacion-periodo {
                padding: 12px;
            }

            .rotacion-horario {
                font-size: 1em;
            }

            .rotacion-fechas {
                font-size: 0.9em;
            }
        }

        /* Responsive Design - M√≥viles peque√±os */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }

            .header h1 {
                font-size: 1.4em;
            }

            .header p {
                font-size: 0.85em;
            }

            .content {
                padding: 15px 10px;
            }

            .section-title {
                font-size: 1.1em;
            }

            .resultado-nombre {
                font-size: 1em;
                word-break: break-word;
            }

            .analista-item label {
                font-size: 0.85em;
                word-break: break-word;
            }
        }

        /* Asegurar que los inputs de fecha sean t√°ctiles */
        input[type="date"] {
            min-height: 44px; /* Tama√±o m√≠nimo t√°ctil recomendado */
        }

        /* Mejorar scroll en m√≥viles - solo para desktop */
        @media (min-width: 769px) {
            .analistas-grid {
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÖ Consulta de Horarios</h1>
            <p>Selecciona analistas y fecha para ver sus horarios</p>
        </div>

        <div class="content">
            <div class="section">
                <h2 class="section-title">1. Selecciona la Fecha</h2>
                <div class="date-selector">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" required>
                </div>
            </div>

            <div class="section">
                <h2 class="section-title">2. Selecciona los Analistas</h2>
                <div class="botones-seleccion">
                    <button class="btn-seleccionar" onclick="seleccionarTodos()">Seleccionar Todos</button>
                    <button class="btn-deseleccionar" onclick="deseleccionarTodos()">Deseleccionar Todos</button>
                    <button class="btn-rotaciones" onclick="mostrarRotacionesHorarios()">üìÖ Ver Rotaciones de Horarios</button>
                </div>
                <div class="analistas-grid" id="analistas-grid">
                    <div class="loading">Cargando analistas...</div>
                </div>
                <div style="margin-top: 15px; text-align: center;">
                    <button class="btn-consultar" onclick="consultarHorarios()">üîç Consultar Horarios</button>
                </div>
            </div>

            <div class="rotaciones-container" id="rotaciones-container">
                <h2 class="section-title">Rotaciones de Horarios</h2>
                <div id="rotaciones-content"></div>
            </div>

            <div class="resultados" id="resultados">
                <h2 class="section-title">Resultados</h2>
                <div id="resultados-content"></div>
            </div>
        </div>
    </div>

    <script>
        let analistas = [];
        // Fecha de inicio general: 17 de diciembre de 2025 (mi√©rcoles) - usado como fallback para patrones normales
        let fechaInicio = new Date('2025-12-17');

        // Datos de analistas (incluidos directamente para funcionar sin servidor)
        const datosAnalistas = {
            "empleados": [
                {
                    "nombre": "Angela Garnica Centanaro",
                    "horario": "09:00 -18:00",
                    "grupo": "A",
                    "dias_laborales": [1, 2, 3, 4, 5],
                    "dias_laborales_texto": ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": true, "2": true, "3": true, "4": true, "5": true, "6": false, "7": false},
                    "rotacion_mi_vi": true,
                    "nota": "Misma rotaci√≥n que Grupo A (Daniel). Rotaci√≥n 10 d√≠as trabajo / 4 d√≠as descanso"
                },
                {
                    "nombre": "Daniel Alfonso Lara Torres",
                    "horario": "06:00 - 15:00",
                    "grupo": "A",
                    "dias_laborales": [3, 4, 5],
                    "dias_laborales_texto": ["Mi√©rcoles", "Jueves", "Viernes"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": false, "2": false, "3": true, "4": true, "5": true, "6": false, "7": false},
                    "rotacion_mi_vi": true,
                    "nota": "Rotaci√≥n 10 d√≠as trabajo / 4 d√≠as descanso. Misma rotaci√≥n que todos los del Grupo A (inicio 17 dic 2025)"
                },
                {
                    "nombre": "Juan Sarmiento",
                    "horario": "00:00 - 09:00",
                    "grupo": "A",
                    "dias_laborales": [3, 4, 5],
                    "dias_laborales_texto": ["Mi√©rcoles", "Jueves", "Viernes"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": false, "2": false, "3": true, "4": true, "5": true, "6": false, "7": false},
                    "rotacion_mi_vi": true,
                    "nota": "Misma rotaci√≥n de d√≠as que Grupo A (Daniel). Alterna horarios: 2 ciclos (28 d√≠as) 00:00-09:00, luego 2 ciclos (28 d√≠as) 15:00-00:00. Inicio: 3 dic 2025 con 00:00-09:00 (complemento de Sebastian)"
                },
                {
                    "nombre": "Julian Sarmiento",
                    "horario": "15:00 -00:00",
                    "grupo": "B",
                    "dias_laborales": [3, 4, 5, 6, 7],
                    "dias_laborales_texto": ["Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": false, "2": false, "3": true, "4": true, "5": true, "6": true, "7": true},
                    "rotacion_mi_vi": true,
                    "nota": "Misma rotaci√≥n que Grupo B. Rotaci√≥n 10 d√≠as trabajo / 4 d√≠as descanso"
                },
                {
                    "nombre": "Oscar Riveros Rodriguez",
                    "horario": "00:00 - 09:00",
                    "grupo": "B",
                    "dias_laborales": [3, 4, 5, 6, 7],
                    "dias_laborales_texto": ["Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": false, "2": false, "3": true, "4": true, "5": true, "6": true, "7": true},
                    "rotacion_mi_vi": true,
                    "nota": "Misma rotaci√≥n de d√≠as que Grupo B. Alterna horarios: 28 d√≠as (7 enero - 3 febrero) 00:00-09:00, luego 28 d√≠as (4 febrero - 3 marzo) 06:00-15:00. Inicio: 7 enero 2026 con 00:00-09:00"
                },
                {
                    "nombre": "Sebastian Ahumada",
                    "horario": "15:00 -00:00",
                    "grupo": "A",
                    "dias_laborales": [3, 4, 5],
                    "dias_laborales_texto": ["Mi√©rcoles", "Jueves", "Viernes"],
                    "trabaja_festivos": true,
                    "trabaja_domingos": true,
                    "patron_semanal": {"1": false, "2": false, "3": true, "4": true, "5": true, "6": false, "7": false},
                    "rotacion_mi_vi": true,
                    "nota": "Misma rotaci√≥n de d√≠as que Grupo A (Daniel). Alterna horarios: 2 ciclos (28 d√≠as) 15:00-00:00, luego 2 ciclos (28 d√≠as) 00:00-09:00. Inicio: 3 dic 2025 con 15:00-00:00"
                }
            ]
        };

        // Cargar analistas
        function cargarAnalistas() {
            analistas = datosAnalistas.empleados;
            mostrarAnalistas();
        }

        function mostrarAnalistas() {
            const grid = document.getElementById('analistas-grid');
            grid.innerHTML = analistas.map((analista, index) => `
                <div class="analista-item">
                    <input type="checkbox" id="analista-${index}" value="${index}">
                    <label for="analista-${index}">${analista.nombre}</label>
                </div>
            `).join('');
        }

        // Fechas de inicio del ciclo seg√∫n grupo
        // Todos los empleados del Grupo A usan la misma rotaci√≥n que Daniel (17 dic 2025)
        // Todos los empleados del Grupo B usan la misma rotaci√≥n (10 dic 2025)
        // Usar componentes de fecha directamente para evitar problemas de zona horaria (UTC-5 Bogot√°)
        const fechaInicioCicloPorGrupo = {
            'A': new Date(2025, 11, 17, 12, 0, 0, 0), // Mi√©rcoles 17 dic 2025 - d√≠a 1 del ciclo (mes 11 = diciembre)
            'B': new Date(2025, 11, 10, 12, 0, 0, 0)   // Mi√©rcoles 10 dic 2025 - d√≠a 1 del ciclo (el 18 dic est√° en d√≠a 9)
        };
        
        // Sebastian y Juan Sarmiento tienen patrones especiales de horarios alternados cada 2 ciclos (28 d√≠as)
        // Sebastian: Inicio 3 dic 2025 con 15:00-00:00, cambio 31 dic 2025 a 00:00-09:00
        // Juan Sarmiento: Inicio 3 dic 2025 con 00:00-09:00, cambio 31 dic 2025 a 15:00-00:00 (complemento de Sebastian)
        // Patr√≥n: 28 d√≠as con un horario, luego 28 d√≠as con el otro, y se repite (ciclo completo de 56 d√≠as)
        const fechaInicioHorariosAlternados = new Date(2025, 11, 3, 12, 0, 0, 0); // 3 dic 2025
        
        // Oscar Riveros tiene un patr√≥n especial: ciclo completo de 56 d√≠as (28 d√≠as cada horario)
        // Inicio: 7 enero 2026 con 00:00-09:00 (hasta 3 febrero, 28 d√≠as)
        // Cambio 1: 4 febrero 2026 a 06:00-15:00 (hasta 3 marzo, 28 d√≠as)
        // Cambio 2: 4 marzo 2026 vuelve a 00:00-09:00 y se repite
        const fechaInicioHorariosOscar = new Date(2026, 0, 7, 12, 0, 0, 0); // 7 enero 2026
        
        function obtenerDiaCicloEmpleado(empleado, fecha) {
            // Cada empleado tiene un ciclo de 14 d√≠as seg√∫n su grupo
            // Grupo A: inicio 17 dic 2025 (misma rotaci√≥n que Daniel)
            // Grupo B: inicio 10 dic 2025 (misma rotaci√≥n del Grupo B)
            // D√≠as 1-10: trabaja
            // D√≠as 11-14: descansa
            
            let fechaInicioEmpleado;
            
            if (empleado.rotacion_mi_vi && fechaInicioCicloPorGrupo[empleado.grupo]) {
                // Usar fecha de inicio seg√∫n el grupo del empleado
                fechaInicioEmpleado = fechaInicioCicloPorGrupo[empleado.grupo];
            } else {
                // Si no tiene patr√≥n rotaci√≥n, usar fecha inicio general
                fechaInicioEmpleado = fechaInicio;
            }
            
            // Normalizar fechas a mediod√≠a para evitar problemas de zona horaria
            const fechaInicioNorm = new Date(fechaInicioEmpleado.getFullYear(), fechaInicioEmpleado.getMonth(), fechaInicioEmpleado.getDate(), 12, 0, 0, 0);
            const fechaNorm = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            
            const delta = fechaNorm - fechaInicioNorm;
            const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
            
            // Calcular d√≠a del ciclo (1-14)
            // d√≠asDesdeInicio = 0 significa d√≠a 1 del ciclo (d√≠a de inicio)
            // d√≠asDesdeInicio = 1 significa d√≠a 2 del ciclo
            // d√≠asDesdeInicio = n significa d√≠a n+1 del ciclo
            // Aplicar m√≥dulo 14 y sumar 1 para obtener d√≠a del ciclo (1-14)
            let diaCiclo = ((diasDesdeInicio % 14) + 14) % 14;
            diaCiclo = diaCiclo + 1; // diasDesdeInicio 0 = d√≠a 1, diasDesdeInicio 1 = d√≠a 2, etc.
            
            // Debug: mostrar c√°lculo
            console.log(`[DEBUG] ${empleado.nombre}:`, {
                fechaInicioNorm: fechaInicioNorm.toLocaleDateString(),
                fechaNorm: fechaNorm.toLocaleDateString(),
                diasDesdeInicio: diasDesdeInicio,
                diaCiclo: diaCiclo
            });
            
            return diaCiclo;
        }
        
        function estaTrabajandoEnCiclo(diaCiclo) {
            // D√≠as 1-10: trabaja
            // D√≠as 11-14: descansa
            return diaCiclo >= 1 && diaCiclo <= 10;
        }
        
        function obtenerHorarioSebastian(fecha) {
            // Sebastian: alterna horarios cada 2 ciclos (28 d√≠as)
            // Inicio: 3 dic 2025 con horario 15:00-00:00
            // Cambio: 31 dic 2025 (28 d√≠as despu√©s) a horario 00:00-09:00
            // Patr√≥n: 28 d√≠as (2 ciclos) con un horario, luego 28 d√≠as con el otro, y se repite (ciclo completo de 56 d√≠as)
            
            const fechaInicioNorm = new Date(fechaInicioHorariosAlternados.getFullYear(), fechaInicioHorariosAlternados.getMonth(), fechaInicioHorariosAlternados.getDate(), 12, 0, 0, 0);
            const fechaNorm = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            
            const delta = fechaNorm - fechaInicioNorm;
            const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
            
            // Calcular ciclo de horarios (1-4) dentro del ciclo completo de 56 d√≠as
            // Ciclo de 56 d√≠as = 4 ciclos de 14 d√≠as
            const cicloHorarios = Math.floor((diasDesdeInicio % 56) / 14) + 1;
            
            // Si est√° en ciclos 1-2 (d√≠as 0-27): horario 15:00-00:00
            // Si est√° en ciclos 3-4 (d√≠as 28-55): horario 00:00-09:00
            if (cicloHorarios <= 2) {
                return '15:00 -00:00';
            } else {
                return '00:00 - 09:00';
            }
        }
        
        function obtenerHorarioJuanSarmiento(fecha) {
            // Juan Sarmiento: alterna horarios cada 2 ciclos (28 d√≠as), complemento de Sebastian
            // Inicio: 3 dic 2025 con horario 00:00-09:00
            // Cambio: 31 dic 2025 (28 d√≠as despu√©s) a horario 15:00-00:00
            // Patr√≥n: 28 d√≠as (2 ciclos) con un horario, luego 28 d√≠as con el otro, y se repite (ciclo completo de 56 d√≠as)
            
            const fechaInicioNorm = new Date(fechaInicioHorariosAlternados.getFullYear(), fechaInicioHorariosAlternados.getMonth(), fechaInicioHorariosAlternados.getDate(), 12, 0, 0, 0);
            const fechaNorm = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            
            const delta = fechaNorm - fechaInicioNorm;
            const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
            
            // Calcular ciclo de horarios (1-4) dentro del ciclo completo de 56 d√≠as
            // Ciclo de 56 d√≠as = 4 ciclos de 14 d√≠as
            const cicloHorarios = Math.floor((diasDesdeInicio % 56) / 14) + 1;
            
            // Si est√° en ciclos 1-2 (d√≠as 0-27): horario 00:00-09:00
            // Si est√° en ciclos 3-4 (d√≠as 28-55): horario 15:00-00:00
            if (cicloHorarios <= 2) {
                return '00:00 - 09:00';
            } else {
                return '15:00 -00:00';
            }
        }
        
        function obtenerHorarioOscarRiveros(fecha) {
            // Oscar Riveros: ciclo completo de 56 d√≠as (28 d√≠as cada horario)
            // Inicio: 7 enero 2026 con horario 00:00-09:00
            // D√≠as 0-27 (7 enero - 3 febrero): 00:00-09:00 (28 d√≠as)
            // D√≠as 28-55 (4 febrero - 3 marzo): 06:00-15:00 (28 d√≠as)
            // D√≠a 56 (4 marzo): vuelve a 00:00-09:00 y se repite
            
            const fechaInicioNorm = new Date(fechaInicioHorariosOscar.getFullYear(), fechaInicioHorariosOscar.getMonth(), fechaInicioHorariosOscar.getDate(), 12, 0, 0, 0);
            const fechaNorm = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            
            const delta = fechaNorm - fechaInicioNorm;
            const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
            
            // Calcular d√≠a dentro del ciclo completo de 56 d√≠as
            const diaEnCiclo = ((diasDesdeInicio % 56) + 56) % 56;
            
            // Si est√° en d√≠as 0-27 (primer per√≠odo de 28 d√≠as): horario 00:00-09:00
            // Si est√° en d√≠as 28-55 (segundo per√≠odo de 28 d√≠as): horario 06:00-15:00
            if (diaEnCiclo < 28) {
                return '00:00 - 09:00';
            } else {
                return '06:00 - 15:00';
            }
        }
        
        function obtenerTipoDia(fecha) {
            const diaSemana = fecha.getDay();
            if (diaSemana === 0) return 'Domingo';
            // Aqu√≠ podr√≠as agregar l√≥gica para festivos
            return 'Laboral';
        }

        function debeTrabajar(analista, fecha) {
            // Normalizar fecha antes de calcular
            const fechaNorm = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            const diaSemana = fechaNorm.getDay() === 0 ? 7 : fechaNorm.getDay(); // 1=Lunes, 7=Domingo
            const tipoDia = obtenerTipoDia(fechaNorm);

            // D√≠as que SIEMPRE trabajan ambos (Mi√©rcoles, Jueves, Viernes)
            const diasMiVi = [3, 4, 5]; // Mi√©rcoles, Jueves, Viernes
            
            // D√≠as que alternan (S√°bado, Domingo, Lunes, Martes)
            const diasAlternos = [6, 7, 1, 2]; // S√°bado, Domingo, Lunes, Martes

            // PATR√ìN ESPECIAL: Rotaci√≥n 10 d√≠as trabajo / 4 d√≠as descanso por grupo
            // Grupo A: mismo ciclo que Daniel (inicio 17 dic 2025)
            // Grupo B: mismo ciclo (inicio 10 dic 2025)
            // - D√≠as 1-10: trabaja (todos los d√≠as, incluido Mi-Vi y S√°b-Dom-Lun-Mar)
            // - D√≠as 11-14: descansa (todos los d√≠as)
            const esPatronRotacion = analista.rotacion_mi_vi === true;

            if (esPatronRotacion) {
                // Obtener d√≠a del ciclo espec√≠fico para este empleado (1-14)
                const diaCiclo = obtenerDiaCicloEmpleado(analista, fechaNorm);
                
                // Si est√° en d√≠as 1-10 del ciclo = trabaja
                // Si est√° en d√≠as 11-14 del ciclo = descansa
                return estaTrabajandoEnCiclo(diaCiclo);
            } else {
                // Patr√≥n normal: usar patr√≥n semanal base
                const trabajaBase = analista.patron_semanal && analista.patron_semanal[diaSemana.toString()] === true;
                
                // Determinar grupo activo para patr√≥n normal (rotaci√≥n semanal)
                const fechaInicioNorm = new Date(fechaInicio.getFullYear(), fechaInicio.getMonth(), fechaInicio.getDate(), 12, 0, 0, 0);
                const delta = fechaNorm - fechaInicioNorm;
                const semanas = Math.floor(delta / (1000 * 60 * 60 * 24 * 7));
                const grupoActivo = semanas % 2 === 0 ? 'A' : 'B';
                const grupoCoincide = analista.grupo === grupoActivo;
                
                if (tipoDia === 'Festivo') {
                    return trabajaBase && analista.trabaja_festivos && grupoCoincide;
                } else if (tipoDia === 'Domingo') {
                    return trabajaBase && analista.trabaja_domingos && grupoCoincide;
                } else {
                    return trabajaBase && grupoCoincide;
                }
            }
        }

        function consultarHorarios() {
            const fechaInput = document.getElementById('fecha').value;
            if (!fechaInput) {
                alert('Por favor selecciona una fecha');
                return;
            }

            // Crear fecha correctamente ajustada sin problemas de zona horaria (UTC-5 Bogot√°)
            // Parsear la fecha en formato YYYY-MM-DD y crear fecha local usando componentes
            const [anio, mes, dia] = fechaInput.split('-').map(Number);
            // Crear fecha en zona horaria local (Bogot√° UTC-5) usando componentes
            const fecha = new Date(anio, mes - 1, dia, 12, 0, 0, 0); // mes - 1 porque Date usa 0-11 para meses
            
            // Verificar que la fecha sea v√°lida
            if (isNaN(fecha.getTime())) {
                alert('Fecha inv√°lida');
                return;
            }
            
            const seleccionados = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => parseInt(cb.value));

            if (seleccionados.length === 0) {
                document.getElementById('resultados-content').innerHTML = 
                    '<div class="no-seleccion">Por favor selecciona al menos un analista</div>';
                document.getElementById('resultados').classList.add('show');
                return;
            }

            const resultados = seleccionados.map(index => {
                const analista = analistas[index];
                // Asegurar que usamos la fecha normalizada para el c√°lculo
                const fechaNormalizada = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
                const trabaja = debeTrabajar(analista, fechaNormalizada);
                return { analista, trabaja };
            });

            mostrarResultados(resultados, fecha);
        }

        function mostrarResultados(resultados, fecha) {
            // Asegurar que la fecha est√© normalizada correctamente
            const fechaNormalizada = new Date(fecha.getFullYear(), fecha.getMonth(), fecha.getDate(), 12, 0, 0, 0);
            
            const diasSemana = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            const diaNombre = diasSemana[fechaNormalizada.getDay()];
            
            // Formatear fecha manualmente para evitar problemas de zona horaria
            const meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 
                          'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            const diasSemanaNombres = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
            
            const fechaFormateada = `${diasSemanaNombres[fechaNormalizada.getDay()]}, ${fechaNormalizada.getDate()} de ${meses[fechaNormalizada.getMonth()]} de ${fechaNormalizada.getFullYear()}`;

            const tipoDia = obtenerTipoDia(fechaNormalizada);
            
            // Obtener informaci√≥n de ciclo para empleados con rotaci√≥n
            let cicloInfoDetalle = '';
            resultados.forEach(({ analista, trabaja }) => {
                if (analista.rotacion_mi_vi) {
                    const diaCiclo = obtenerDiaCicloEmpleado(analista, fechaNormalizada);
                    const estadoCiclo = estaTrabajandoEnCiclo(diaCiclo) ? 'Trabajando' : 'Descansando';
                    // Debug: verificar c√°lculo
                    console.log(`${analista.nombre} - Fecha: ${fechaNormalizada.toLocaleDateString()} - D√≠a ciclo: ${diaCiclo} - Estado: ${estadoCiclo}`);
                    // Mostrar informaci√≥n del ciclo
                    cicloInfoDetalle += `<br><strong>${analista.nombre}:</strong> D√≠a ${diaCiclo} del ciclo (${estadoCiclo})`;
                }
            });

            let html = `<div style="margin-bottom: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                <strong>üìÖ Fecha consultada:</strong> ${fechaFormateada}<br>
                <strong>üìã Tipo de d√≠a:</strong> ${tipoDia}${cicloInfoDetalle}
            </div>`;

            resultados.forEach(({ analista, trabaja }) => {
                const claseEstado = trabaja ? 'trabaja' : 'no-trabaja';
                const estadoTexto = trabaja ? '‚úì Trabaja' : '‚úó No trabaja';
                
                // Sebastian, Juan Sarmiento y Oscar Riveros tienen horarios din√°micos seg√∫n el ciclo de horarios
                let horarioMostrar = analista.horario;
                if (analista.nombre === 'Sebastian Ahumada') {
                    horarioMostrar = obtenerHorarioSebastian(fechaNormalizada);
                } else if (analista.nombre === 'Juan Sarmiento') {
                    horarioMostrar = obtenerHorarioJuanSarmiento(fechaNormalizada);
                } else if (analista.nombre === 'Oscar Riveros Rodriguez') {
                    horarioMostrar = obtenerHorarioOscarRiveros(fechaNormalizada);
                }
                
                html += `
                    <div class="resultado-item ${claseEstado}">
                        <div class="resultado-header">
                            <div class="resultado-nombre">${analista.nombre}</div>
                            <div class="resultado-estado ${claseEstado}">${estadoTexto}</div>
                        </div>
                        <div class="resultado-detalles">
                            <div class="detalle-item">
                                <div class="detalle-label">Horario</div>
                                <div class="detalle-valor">${horarioMostrar}</div>
                            </div>
                            <div class="detalle-item">
                                <div class="detalle-label">Grupo</div>
                                <div class="detalle-valor">${analista.grupo}</div>
                            </div>
                            ${analista.rotacion_mi_vi ? `
                            <div class="detalle-item">
                                <div class="detalle-label">Patr√≥n</div>
                                <div class="detalle-valor">Rotaci√≥n Mi-Vi</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });

            document.getElementById('resultados-content').innerHTML = html;
            document.getElementById('resultados').classList.add('show');
            
            // Scroll suave a los resultados
            document.getElementById('resultados').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function seleccionarTodos() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
        }

        function deseleccionarTodos() {
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        }

        // Funci√≥n para formatear fechas
        function formatearFecha(fecha) {
            const meses = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 
                          'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
            const diasSemana = ['domingo', 'lunes', 'martes', 'mi√©rcoles', 'jueves', 'viernes', 's√°bado'];
            return `${diasSemana[fecha.getDay()]}, ${fecha.getDate()} de ${meses[fecha.getMonth()]} de ${fecha.getFullYear()}`;
        }

        // Funci√≥n para calcular per√≠odos de rotaci√≥n de horarios
        function calcularRotacionesHorarios(nombreEmpleado, fechaReferencia) {
            const fechaRef = new Date(fechaReferencia.getFullYear(), fechaReferencia.getMonth(), fechaReferencia.getDate(), 12, 0, 0, 0);
            const rotaciones = [];

            if (nombreEmpleado === 'Sebastian Ahumada') {
                // Sebastian: ciclo de 56 d√≠as (28 d√≠as cada horario)
                // Inicio: 3 dic 2025 con 15:00-00:00
                const fechaInicio = new Date(2025, 11, 3, 12, 0, 0, 0); // 3 dic 2025
                
                // Calcular cu√°ntos ciclos completos han pasado
                const delta = fechaRef - fechaInicio;
                const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
                const ciclosCompletos = Math.floor(diasDesdeInicio / 56);
                
                // Calcular el inicio del ciclo actual
                const inicioCicloActual = new Date(fechaInicio);
                inicioCicloActual.setDate(inicioCicloActual.getDate() + (ciclosCompletos * 56));
                
                // Per√≠odo 1: 28 d√≠as con horario 15:00-00:00
                const inicio1 = new Date(inicioCicloActual);
                const fin1 = new Date(inicio1);
                fin1.setDate(fin1.getDate() + 27);
                rotaciones.push({ horario: '15:00 - 00:00', inicio: inicio1, fin: fin1 });
                
                // Per√≠odo 2: 28 d√≠as con horario 00:00-09:00
                const inicio2 = new Date(fin1);
                inicio2.setDate(inicio2.getDate() + 1);
                const fin2 = new Date(inicio2);
                fin2.setDate(fin2.getDate() + 27);
                rotaciones.push({ horario: '00:00 - 09:00', inicio: inicio2, fin: fin2 });
                
                // Agregar siguiente ciclo para referencia
                const inicioSiguiente1 = new Date(fin2);
                inicioSiguiente1.setDate(inicioSiguiente1.getDate() + 1);
                const finSiguiente1 = new Date(inicioSiguiente1);
                finSiguiente1.setDate(finSiguiente1.getDate() + 27);
                rotaciones.push({ horario: '15:00 - 00:00', inicio: inicioSiguiente1, fin: finSiguiente1 });
                
            } else if (nombreEmpleado === 'Juan Sarmiento') {
                // Juan Sarmiento: ciclo de 56 d√≠as (28 d√≠as cada horario), complemento de Sebastian
                // Inicio: 3 dic 2025 con 00:00-09:00
                const fechaInicio = new Date(2025, 11, 3, 12, 0, 0, 0); // 3 dic 2025
                
                const delta = fechaRef - fechaInicio;
                const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
                const ciclosCompletos = Math.floor(diasDesdeInicio / 56);
                
                const inicioCicloActual = new Date(fechaInicio);
                inicioCicloActual.setDate(inicioCicloActual.getDate() + (ciclosCompletos * 56));
                
                // Per√≠odo 1: 28 d√≠as con horario 00:00-09:00
                const inicio1 = new Date(inicioCicloActual);
                const fin1 = new Date(inicio1);
                fin1.setDate(fin1.getDate() + 27);
                rotaciones.push({ horario: '00:00 - 09:00', inicio: inicio1, fin: fin1 });
                
                // Per√≠odo 2: 28 d√≠as con horario 15:00-00:00
                const inicio2 = new Date(fin1);
                inicio2.setDate(inicio2.getDate() + 1);
                const fin2 = new Date(inicio2);
                fin2.setDate(fin2.getDate() + 27);
                rotaciones.push({ horario: '15:00 - 00:00', inicio: inicio2, fin: fin2 });
                
                // Agregar siguiente ciclo
                const inicioSiguiente1 = new Date(fin2);
                inicioSiguiente1.setDate(inicioSiguiente1.getDate() + 1);
                const finSiguiente1 = new Date(inicioSiguiente1);
                finSiguiente1.setDate(finSiguiente1.getDate() + 27);
                rotaciones.push({ horario: '00:00 - 09:00', inicio: inicioSiguiente1, fin: finSiguiente1 });
                
            } else if (nombreEmpleado === 'Oscar Riveros Rodriguez') {
                // Oscar: ciclo de 56 d√≠as (28 d√≠as 00:00-09:00, luego 28 d√≠as 06:00-15:00)
                // Inicio: 7 enero 2026 con 00:00-09:00
                const fechaInicio = new Date(2026, 0, 7, 12, 0, 0, 0); // 7 enero 2026
                
                const delta = fechaRef - fechaInicio;
                const diasDesdeInicio = Math.floor(delta / (1000 * 60 * 60 * 24));
                const ciclosCompletos = Math.floor(diasDesdeInicio / 56);
                
                const inicioCicloActual = new Date(fechaInicio);
                inicioCicloActual.setDate(inicioCicloActual.getDate() + (ciclosCompletos * 56));
                
                // Per√≠odo 1: 28 d√≠as con horario 00:00-09:00 (7 enero - 3 febrero)
                const inicio1 = new Date(inicioCicloActual);
                const fin1 = new Date(inicio1);
                fin1.setDate(fin1.getDate() + 27);
                rotaciones.push({ horario: '00:00 - 09:00', inicio: inicio1, fin: fin1 });
                
                // Per√≠odo 2: 28 d√≠as con horario 06:00-15:00 (4 febrero - 3 marzo)
                const inicio2 = new Date(fin1);
                inicio2.setDate(inicio2.getDate() + 1);
                const fin2 = new Date(inicio2);
                fin2.setDate(fin2.getDate() + 27);
                rotaciones.push({ horario: '06:00 - 15:00', inicio: inicio2, fin: fin2 });
                
                // Agregar siguiente ciclo
                const inicioSiguiente1 = new Date(fin2);
                inicioSiguiente1.setDate(inicioSiguiente1.getDate() + 1);
                const finSiguiente1 = new Date(inicioSiguiente1);
                finSiguiente1.setDate(finSiguiente1.getDate() + 27);
                rotaciones.push({ horario: '00:00 - 09:00', inicio: inicioSiguiente1, fin: finSiguiente1 });
                
            }
            
            return rotaciones;
        }

        // Funci√≥n para mostrar rotaciones de horarios
        function mostrarRotacionesHorarios() {
            const container = document.getElementById('rotaciones-container');
            const content = document.getElementById('rotaciones-content');
            
            if (container.classList.contains('show')) {
                // Ocultar
                container.classList.remove('show');
                return;
            }
            
            // Empleados que tienen rotaci√≥n de horarios
            const empleadosConRotacion = ['Sebastian Ahumada', 'Juan Sarmiento', 'Oscar Riveros Rodriguez'];
            const fechaActual = new Date();
            
            let html = '';
            
            empleadosConRotacion.forEach(nombre => {
                const rotaciones = calcularRotacionesHorarios(nombre, fechaActual);
                if (rotaciones.length > 0) {
                    html += `<div class="rotacion-item">
                        <div class="rotacion-nombre">${nombre}</div>`;
                    
                    rotaciones.forEach((rotacion, index) => {
                        const esActual = fechaActual >= rotacion.inicio && fechaActual <= rotacion.fin;
                        const claseActual = esActual ? ' style="border-left-color: #28a745; background: #d4edda;"' : '';
                        
                        html += `<div class="rotacion-periodo"${claseActual}>
                            <div class="rotacion-horario">${rotacion.horario} ${esActual ? '<span style="color: #28a745; font-size: 0.9em;">(ACTUAL)</span>' : ''}</div>
                            <div class="rotacion-fechas">
                                <strong>Inicio:</strong> ${formatearFecha(rotacion.inicio)}<br>
                                <strong>Fin:</strong> ${formatearFecha(rotacion.fin)}
                            </div>
                        </div>`;
                    });
                    
                    html += `</div>`;
                }
            });
            
            if (html === '') {
                html = '<div class="no-seleccion">No hay empleados con rotaci√≥n de horarios</div>';
            }
            
            content.innerHTML = html;
            container.classList.add('show');
            
            // Scroll suave a las rotaciones
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Establecer fecha por defecto (hoy)
        document.getElementById('fecha').valueAsDate = new Date();

        // Cargar analistas al iniciar
        cargarAnalistas();
    </script>
</body>
</html>

